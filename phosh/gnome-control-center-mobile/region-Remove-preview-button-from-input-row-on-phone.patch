From 5db41b3cf317173db97553f7259428a8046096e7 Mon Sep 17 00:00:00 2001
From: Mohammed Sadiq <sadiq@sadiqpk.org>
Date: Mon, 13 Jan 2020 14:44:01 +0530
Subject: [PATCH 6/8] region: Remove preview button from input row on phones
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

We donâ€™t want this on librem5 where there is no hardware keyboard.  Also, as the
window is too big, we might want something else even with keyboard on librem5

Fixes https://source.puri.sm/Librem5/gnome-control-center/issues/96
---
 panels/region/cc-input-row.c  | 6 ++++++
 panels/region/cc-input-row.ui | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/panels/region/cc-input-row.c b/panels/region/cc-input-row.c
index eadc20443..46a70cd0a 100644
--- a/panels/region/cc-input-row.c
+++ b/panels/region/cc-input-row.c
@@ -18,6 +18,7 @@
 #include <config.h>
 #include "cc-input-row.h"
 #include "cc-input-source-ibus.h"
+#include "list-box-helper.h"
 
 struct _CcInputRow
 {
@@ -29,6 +30,7 @@ struct _CcInputRow
   GtkLabel        *name_label;
   GtkButton       *remove_button;
   GtkButton       *settings_button;
+  GtkButton       *preview_button;
 
   GtkListBox      *drag_widget;
 };
@@ -160,6 +162,7 @@ cc_input_row_class_init (CcInputRowClass *klass)
   gtk_widget_class_bind_template_child (widget_class, CcInputRow, name_label);
   gtk_widget_class_bind_template_child (widget_class, CcInputRow, remove_button);
   gtk_widget_class_bind_template_child (widget_class, CcInputRow, settings_button);
+  gtk_widget_class_bind_template_child (widget_class, CcInputRow, preview_button);
 
   gtk_widget_class_bind_template_callback (widget_class, drag_data_get_cb);
   gtk_widget_class_bind_template_callback (widget_class, drag_begin_cb);
@@ -222,6 +225,9 @@ cc_input_row_init (CcInputRow *self)
 
   gtk_drag_source_set (GTK_WIDGET (self->drag_handle), GDK_BUTTON1_MASK, entries, 1, GDK_ACTION_MOVE);
   gtk_drag_dest_set (GTK_WIDGET (self), GTK_DEST_DEFAULT_ALL, entries, 1, GDK_ACTION_MOVE);
+
+  if (pureos_get_is_phone ())
+    gtk_widget_hide (GTK_WIDGET (self->preview_button));
 }
 
 static void
diff --git a/panels/region/cc-input-row.ui b/panels/region/cc-input-row.ui
index 70794fcee..b5a309d0b 100644
--- a/panels/region/cc-input-row.ui
+++ b/panels/region/cc-input-row.ui
@@ -57,7 +57,7 @@
               </object>
             </child>
             <child>
-              <object class="GtkButton">
+              <object class="GtkButton" id="preview_button">
                 <property name="visible">True</property>
                 <property name="margin_bottom">8</property>
                 <property name="margin_top">8</property>
-- 
2.31.0

